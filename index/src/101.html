<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\richard\documents\ckansplit\ckan-core\tests\testdata.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using CKAN;
using Version = CKAN.Version;

namespace Tests
{
    static public class TestData
    {
        public static string DataDir()
        {
            // TODO: Have this actually walk our directory structure and find
            // t/data. This means we can relocate our test executable and
            // things will still work.
            string current = Directory.GetCurrentDirectory();

            return Path.Combine(current, &quot;../../../t/data&quot;);
        }

        public static string DataDir(string file)
        {
            return Path.Combine(DataDir(), file);
        }

        /// &lt;summary&gt;
        /// Returns the full path to DogeCoinFlag-1.01.zip
        /// &lt;/summary&gt;
        public static string DogeCoinFlagZip()
        {
            string such_zip_very_currency_wow = Path.Combine(DataDir(), &quot;DogeCoinFlag-1.01.zip&quot;);

            return such_zip_very_currency_wow;
        }

        /// &lt;summary&gt;
        /// Returns DogeCoinFlag.zip, with extra files inside.
        /// Great for testing filters.
        /// &lt;/summary&gt;
        public static string DogeCoinFlagZipWithExtras()
        {
            return Path.Combine(DataDir(), &quot;DogeCoinFlag-extra-files.zip&quot;);
        }

        /// &lt;summary&gt;
        /// Returns the full path to DogeCoinFlag-1.01-corrupt.zip
        /// &lt;/summary&gt;
        public static string DogeCoinFlagZipCorrupt()
        {
            string such_zip_very_corrupt_wow = Path.Combine(DataDir(), &quot;DogeCoinFlag-1.01-corrupt.zip&quot;);

            return such_zip_very_corrupt_wow;
        }


        ///&lt;summary&gt;
        /// DogeCoinFlag 1.01 info. This contains a bug where the
        /// install stanza doesn&#39;t actually refer to any files.
        ///&lt;/summary&gt;
        public static string DogeCoinFlag_101_bugged()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;DogeCoinFlag&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                        &quot;&quot;file&quot;&quot;: &quot;&quot;GameData/DogeCoinFlag&quot;&quot;,
                        &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;kerbalstuff&quot;&quot;: {
                        &quot;&quot;url&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag&quot;&quot;
                        },
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;https://www.reddit.com/r/dogecoin/comments/1tdlgg/i_made_a_more_accurate_dogecoin_and_a_ksp_flag/&quot;&quot;
                    },
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Dogecoin Flag&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;Such flag. Very currency. To the mun! Wow!&quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;pjf&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.01&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag/download/1.01&quot;&quot;,
                    &quot;&quot;comment&quot;&quot;: &quot;&quot;Generated by ks2ckan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 53647,
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.25&quot;&quot;
                }
            &quot;;
        }

        public static CkanModule DogeCoinFlag_101_bugged_module()
        {
            return CkanModule.FromJson(DogeCoinFlag_101_bugged());
        }

        ///&lt;summary&gt;
        /// DogeCoinFlag 1.01 info. This doesn&#39;t contain any bugs.
        ///&lt;/summary&gt;
        public static string DogeCoinFlag_101()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;DogeCoinFlag&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                        &quot;&quot;file&quot;&quot;: &quot;&quot;DogeCoinFlag-1.01/GameData/DogeCoinFlag&quot;&quot;,
                        &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;,
                        &quot;&quot;filter&quot;&quot; : [ &quot;&quot;Thumbs.db&quot;&quot;, &quot;&quot;README.md&quot;&quot; ],
                        &quot;&quot;filter_regexp&quot;&quot; : &quot;&quot;\\.bak$&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;kerbalstuff&quot;&quot;: {
                        &quot;&quot;url&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag&quot;&quot;
                        },
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;https://www.reddit.com/r/dogecoin/comments/1tdlgg/i_made_a_more_accurate_dogecoin_and_a_ksp_flag/&quot;&quot;
                    },
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Dogecoin Flag&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;Such flag. Very currency. To the mun! Wow!&quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;pjf&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.01&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag/download/1.01&quot;&quot;,
                    &quot;&quot;comment&quot;&quot;: &quot;&quot;Generated by ks2ckan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 53647,
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.25&quot;&quot;
                }
            &quot;;
        }

        public static CkanModule DogeCoinFlag_101_module()
        {
            return CkanModule.FromJson(DogeCoinFlag_101());
        }

        /// &lt;summary&gt;
        /// The Doge Coin flag we all love, but using `find` install stanzas.
        /// &lt;/summary&gt;
        public static CkanModule DogeCoinFlag_101_module_find()
        {
            CkanModule doge = DogeCoinFlag_101_module();

            // Hand hack in the &#39;find&#39; directive.
            doge.install[0].file = null;
            doge.install[0].find = &quot;DogeCoinFlag&quot;;

            return doge;
        }

        // Identical to DogeCoinFlag_101, but with a spec version over 9000!
        public static string FutureMetaData()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: &quot;&quot;v9000.0.1&quot;&quot;,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;DogeCoinFlag&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                        &quot;&quot;file&quot;&quot;: &quot;&quot;DogeCoinFlag-1.01/GameData/DogeCoinFlag&quot;&quot;,
                        &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;,
                        &quot;&quot;filter&quot;&quot; : [ &quot;&quot;Thumbs.db&quot;&quot;, &quot;&quot;README.md&quot;&quot; ],
                        &quot;&quot;filter_regexp&quot;&quot; : &quot;&quot;\\.bak$&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;kerbalstuff&quot;&quot;: {
                        &quot;&quot;url&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag&quot;&quot;
                        },
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;https://www.reddit.com/r/dogecoin/comments/1tdlgg/i_made_a_more_accurate_dogecoin_and_a_ksp_flag/&quot;&quot;
                    },
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Dogecoin Flag&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;Such flag. Very currency. To the mun! Wow!&quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;pjf&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.01&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag/download/1.01&quot;&quot;,
                    &quot;&quot;comment&quot;&quot;: &quot;&quot;Generated by ks2ckan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 53647,
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.25&quot;&quot;
                }
            &quot;;
        }

        /// &lt;summary&gt;
        /// Taurus HCV pod, which seems to cause weird KS errors when the unescaped
        /// download string is used.
        /// &lt;/summary&gt;
        public static string RandSCapsuleDyne()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Taurus HCV - 3.75 m Stock-ish Crew Pod&quot;&quot;,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;RandSCapsuledyne&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY-SA-3.0&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                            &quot;&quot;file&quot;&quot;: &quot;&quot;GameData/R&amp;SCapsuledyne&quot;&quot;,
                            &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;
                        }
                    ],
                    &quot;&quot;depends&quot;&quot;: [
                        {
                            &quot;&quot;name&quot;&quot;: &quot;&quot;BDAnimationModules&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;http://forum.kerbalspaceprogram.com/threads/75074-Taurus-HCV-3-75-m-Stock-ish-Crew-Pod-v-b0-5-April-4-2014?p=1064792#post1064792&quot;&quot;,
                        &quot;&quot;kerbalstuff&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/13/Taurus%20HCV%20-%203.75%20m%20Stock-ish%20Crew%20Pod&quot;&quot;
                    },
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.90&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;0.90.0 COMPATIBLE! The Taurus High Capacity Vehicle is a 7 kerbal, 3.75-m cockpit designed to integrate well with the stock game. &quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;jnrobinson&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.4.0&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/13/Taurus%20HCV%20-%203.75%20m%20Stock-ish%20Crew%20Pod/download/1.4.0&quot;&quot;,
                    &quot;&quot;x_generated_by&quot;&quot;: &quot;&quot;netkan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 8351916
                }
            &quot;;
        }

        public static CkanModule RandSCapsuleDyneModule()
        {
            return CkanModule.FromJson(RandSCapsuleDyne());
        }

        public static Uri TestKAN()
        {
            return new Uri(&quot;../../../Tests/DATA/CKAN-meta-testkan.zip&quot;, UriKind.Relative);
        }

		// Same as TestKAN above, just repacked as tar.gz.
		public static Uri TestKANTarGz()
		{
			return new Uri(&quot;../../../Tests/DATA/CKAN-meta-testkan.tar.gz&quot;, UriKind.Relative);
		}

        // A repo full of deliciously bad metadata...
        public static Uri BadKAN()
        {
            return new Uri(&quot;../../../Tests/DATA/CKAN-meta-badkan.zip&quot;, UriKind.Relative);
        }

        public static string good_ksp_dir()
        {
            return Path.Combine(DataDir(), &quot;KSP/KSP-0.25&quot;);
        }

        public static List&lt;string&gt; bad_ksp_dirs()
        {
            var dirs = new List&lt;string&gt;
            {
                Path.Combine(DataDir(), &quot;KSP/bad-ksp&quot;),
                Path.Combine(DataDir(), &quot;KSP/missing-gamedata&quot;)
            };

            return dirs;
        }

        public static string kOS_014()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;name&quot;&quot;     : &quot;&quot;kOS - Kerbal OS&quot;&quot;,
                    &quot;&quot;identifier&quot;&quot; : &quot;&quot;kOS&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot; : &quot;&quot;A programming and automation environment for KSP craft.&quot;&quot;,
                    &quot;&quot;download&quot;&quot; : &quot;&quot;https://github.com/KSP-KOS/KOS/releases/download/v0.14/kOS.v14.zip&quot;&quot;,
                    &quot;&quot;license&quot;&quot;  : &quot;&quot;GPL-3.0&quot;&quot;,
                    &quot;&quot;version&quot;&quot;  : &quot;&quot;0.14&quot;&quot;,
                    &quot;&quot;release_status&quot;&quot; : &quot;&quot;stable&quot;&quot;,
                    &quot;&quot;ksp_version&quot;&quot; : &quot;&quot;0.24.2&quot;&quot;,
                    &quot;&quot;resources&quot;&quot; : {
                        &quot;&quot;homepage&quot;&quot; : &quot;&quot;http://forum.kerbalspaceprogram.com/threads/68089-0-23-kOS-Scriptable-Autopilot-System-v0-11-2-13&quot;&quot;,
                        &quot;&quot;manual&quot;&quot;   : &quot;&quot;http://ksp-kos.github.io/KOS_DOC/&quot;&quot;,
                        &quot;&quot;bugtracker&quot;&quot;: &quot;&quot;https://github.com/KSP-KOS/KOS/issues&quot;&quot;,
                        &quot;&quot;github&quot;&quot;   : {
                            &quot;&quot;url&quot;&quot;      : &quot;&quot;https://github.com/KSP-KOS/KOS&quot;&quot;,
                            &quot;&quot;releases&quot;&quot; : true
                        }
                    },
                    &quot;&quot;install&quot;&quot; : [
                        {
                            &quot;&quot;file&quot;&quot;       : &quot;&quot;GameData/kOS&quot;&quot;,
                            &quot;&quot;install_to&quot;&quot; : &quot;&quot;GameData&quot;&quot;
                        }
                    ]
                }&quot;
            ;
        }

        public static CkanModule kOS_014_module()
        {
            return CkanModule.FromJson(kOS_014());
        }

        public static string KS_CustomAsteroids_string()
        {
            return File.ReadAllText(Path.Combine(DataDir(), &quot;KS/CustomAsteroids.json&quot;));
        }

        public static CkanModule FireSpitterModule()
        {
            return CkanModule.FromFile(Path.Combine(DataDir(), &quot;Firespitter-6.3.5.ckan&quot;));
        }

        public static string KspAvcJson()
        {
            return File.ReadAllText(Path.Combine(DataDir(), &quot;ksp-avc.version&quot;));
        }

        public static CkanModule ModuleManagerModule()
        {
            return CkanModule.FromFile(DataDir(&quot;ModuleManager-2.5.1.ckan&quot;));
        }

        public static string ModuleManagerZip()
        {
            return DataDir(&quot;ModuleManager-2.5.1.zip&quot;);
        }

        /// &lt;summary&gt;
        /// A path to our test registry.json file. Please copy before using.
        /// &lt;/summary&gt;
        public static string TestRegistry()
        {
            return DataDir(&quot;registry.json&quot;);
        }

        // Where&#39;s my mkdtemp? Instead we&#39;ll make a random file, delete it, and
        // fill its place with a directory.
        // Taken from https://stackoverflow.com/a/20445952
        public static string NewTempDir()
        {
            string temp_folder = Path.GetTempFileName();
            File.Delete(temp_folder);
            Directory.CreateDirectory(temp_folder);

            return temp_folder;
        }

        // Ugh, this is awful.
        public static void CopyDirectory(string src, string dst)
        {
            // Create directory structure
            foreach (string path in Directory.GetDirectories(src, &quot;*&quot;, SearchOption.AllDirectories))
            {
                Directory.CreateDirectory(path.Replace(src, dst));
            }

            // Copy files.
            foreach (string file in Directory.GetFiles(src, &quot;*&quot;, SearchOption.AllDirectories))
            {
                File.Copy(file, file.Replace(src, dst));
            }
        }
    }

    public class RandomModuleGenerator
    {
        public Random Generator { get; set; }

        public RandomModuleGenerator(Random generator)
        {
            Generator = generator;
        }

        public CkanModule GeneratorRandomModule(
            KSPVersion kspVersion = null,
            List&lt;RelationshipDescriptor&gt; conflicts = null,
            List&lt;RelationshipDescriptor&gt; depends = null,
            List&lt;RelationshipDescriptor&gt; sugests = null,
            List&lt;String&gt; provides = null,
            string identifier = null,
            Version version = null)
        {
            var mod = new CkanModule
            {
                name = Generator.Next().ToString(CultureInfo.InvariantCulture),
                @abstract = Generator.Next().ToString(CultureInfo.InvariantCulture),
                identifier = identifier??Generator.Next().ToString(CultureInfo.InvariantCulture),
                spec_version = new Version(1.ToString(CultureInfo.InvariantCulture)),
                ksp_version = kspVersion ?? new KSPVersion(&quot;0.&quot; + Generator.Next()),
                version = version ?? new Version(Generator.Next().ToString(CultureInfo.InvariantCulture))
            };
            mod.ksp_version_max = mod.ksp_version_min = new KSPVersion(null);
            mod.conflicts = conflicts;
            mod.depends = depends;
            mod.suggests = sugests;
            mod.provides = provides;
            return mod;
        }
    }
}


    </pre>
    <script type="text/javascript">
      highlightRanges([[154,9,154,10,0],[155,13,183,15,0],[184,9,184,10,0],[191,9,191,10,0],[192,13,221,15,0],[222,9,222,10,0],[225,9,225,10,0],[226,13,226,60,0],[227,9,227,10,0],[300,9,300,10,0],[301,13,301,89,0],[302,9,302,10,0],[310,9,310,10,0],[311,13,311,81,0],[312,9,312,10,0],[13,9,13,10,1],[17,13,17,62,1],[19,13,19,61,1],[20,9,20,10,1],[23,9,23,10,1],[24,13,24,50,1],[25,9,25,10,1],[31,9,31,10,1],[32,13,32,98,1],[34,13,34,47,1],[35,9,35,10,1],[42,9,42,10,1],[43,13,43,76,1],[44,9,44,10,1],[50,9,50,10,1],[51,13,51,105,1],[53,13,53,46,1],[54,9,54,10,1],[62,9,62,10,1],[63,13,89,15,1],[90,9,90,10,1],[93,9,93,10,1],[94,13,94,67,1],[95,9,95,10,1],[101,9,101,10,1],[102,13,130,15,1],[131,9,131,10,1],[134,9,134,10,1],[135,13,135,60,1],[136,9,136,10,1],[142,9,142,10,1],[143,13,143,57,1],[146,13,146,41,1],[147,13,147,51,1],[149,13,149,25,1],[150,9,150,10,1],[230,9,230,10,1],[231,13,231,91,1],[232,9,232,10,1],[236,3,236,4,1],[237,4,237,85,1],[238,3,238,4,1],[242,9,242,10,1],[243,13,243,90,1],[244,9,244,10,1],[247,9,247,10,1],[248,13,248,60,1],[249,9,249,10,1],[252,9,252,10,1],[253,13,257,15,1],[259,13,259,25,1],[260,9,260,10,1],[263,9,263,10,1],[264,13,291,14,1],[292,9,292,10,1],[295,9,295,10,1],[296,13,296,51,1],[297,9,297,10,1],[305,9,305,10,1],[306,13,306,91,1],[307,9,307,10,1],[315,9,315,10,1],[316,13,316,77,1],[317,9,317,10,1],[320,9,320,10,1],[321,13,321,55,1],[322,9,322,10,1],[328,9,328,10,1],[329,13,329,45,1],[330,9,330,10,1],[336,9,336,10,1],[337,13,337,57,1],[338,13,338,38,1],[339,13,339,52,1],[341,13,341,32,1],[342,9,342,10,1],[346,9,346,10,1],[348,13,348,20,1],[348,37,348,100,1],[348,22,348,33,1],[349,13,349,14,1],[350,17,350,67,1],[351,13,351,14,1],[348,34,348,36,1],[354,13,354,20,1],[354,37,354,94,1],[354,22,354,33,1],[355,13,355,14,1],[356,17,356,57,1],[357,13,357,14,1],[354,34,354,36,1],[358,9,358,10,1],[363,35,363,39,1],[363,40,363,44,1],[365,9,365,55,1],[366,9,366,10,1],[367,13,367,35,1],[368,9,368,10,1],[378,9,378,10,1],[379,13,387,15,1],[388,13,388,78,1],[389,13,389,39,1],[390,13,390,35,1],[391,13,391,36,1],[392,13,392,37,1],[393,13,393,24,1],[394,9,394,10,1]]);
    </script>
  </body>
</html>