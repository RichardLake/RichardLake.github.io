<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\richard\documents\ckansplit\netkan\tests\testdata.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using CKAN;
using Version = CKAN.Version;

namespace Tests
{
    static public class TestData
    {
        public static string DataDir()
        {
            // TODO: Have this actually walk our directory structure and find
            // t/data. This means we can relocate our test executable and
            // things will still work.
            string current = Directory.GetCurrentDirectory();

            return Path.Combine(current, &quot;../../../t/data&quot;);
        }

        public static string DataDir(string file)
        {
            return Path.Combine(DataDir(), file);
        }

        /// &lt;summary&gt;
        /// Returns the full path to DogeCoinFlag-1.01.zip
        /// &lt;/summary&gt;
        public static string DogeCoinFlagZip()
        {
            string such_zip_very_currency_wow = Path.Combine(DataDir(), &quot;DogeCoinFlag-1.01.zip&quot;);

            return such_zip_very_currency_wow;
        }

        /// &lt;summary&gt;
        /// Returns DogeCoinFlag.zip, with extra files inside.
        /// Great for testing filters.
        /// &lt;/summary&gt;
        public static string DogeCoinFlagZipWithExtras()
        {
            return Path.Combine(DataDir(), &quot;DogeCoinFlag-extra-files.zip&quot;);
        }

        /// &lt;summary&gt;
        /// Returns the full path to DogeCoinFlag-1.01-corrupt.zip
        /// &lt;/summary&gt;
        public static string DogeCoinFlagZipCorrupt()
        {
            string such_zip_very_corrupt_wow = Path.Combine(DataDir(), &quot;DogeCoinFlag-1.01-corrupt.zip&quot;);

            return such_zip_very_corrupt_wow;
        }


        ///&lt;summary&gt;
        /// DogeCoinFlag 1.01 info. This contains a bug where the
        /// install stanza doesn&#39;t actually refer to any files.
        ///&lt;/summary&gt;
        public static string DogeCoinFlag_101_bugged()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;DogeCoinFlag&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                        &quot;&quot;file&quot;&quot;: &quot;&quot;GameData/DogeCoinFlag&quot;&quot;,
                        &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;kerbalstuff&quot;&quot;: {
                        &quot;&quot;url&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag&quot;&quot;
                        },
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;https://www.reddit.com/r/dogecoin/comments/1tdlgg/i_made_a_more_accurate_dogecoin_and_a_ksp_flag/&quot;&quot;
                    },
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Dogecoin Flag&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;Such flag. Very currency. To the mun! Wow!&quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;pjf&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.01&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag/download/1.01&quot;&quot;,
                    &quot;&quot;comment&quot;&quot;: &quot;&quot;Generated by ks2ckan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 53647,
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.25&quot;&quot;
                }
            &quot;;
        }

        public static CkanModule DogeCoinFlag_101_bugged_module()
        {
            return CkanModule.FromJson(DogeCoinFlag_101_bugged());
        }

        ///&lt;summary&gt;
        /// DogeCoinFlag 1.01 info. This doesn&#39;t contain any bugs.
        ///&lt;/summary&gt;
        public static string DogeCoinFlag_101()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;DogeCoinFlag&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                        &quot;&quot;file&quot;&quot;: &quot;&quot;DogeCoinFlag-1.01/GameData/DogeCoinFlag&quot;&quot;,
                        &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;,
                        &quot;&quot;filter&quot;&quot; : [ &quot;&quot;Thumbs.db&quot;&quot;, &quot;&quot;README.md&quot;&quot; ],
                        &quot;&quot;filter_regexp&quot;&quot; : &quot;&quot;\\.bak$&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;kerbalstuff&quot;&quot;: {
                        &quot;&quot;url&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag&quot;&quot;
                        },
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;https://www.reddit.com/r/dogecoin/comments/1tdlgg/i_made_a_more_accurate_dogecoin_and_a_ksp_flag/&quot;&quot;
                    },
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Dogecoin Flag&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;Such flag. Very currency. To the mun! Wow!&quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;pjf&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.01&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag/download/1.01&quot;&quot;,
                    &quot;&quot;comment&quot;&quot;: &quot;&quot;Generated by ks2ckan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 53647,
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.25&quot;&quot;
                }
            &quot;;
        }

        public static CkanModule DogeCoinFlag_101_module()
        {
            return CkanModule.FromJson(DogeCoinFlag_101());
        }

        /// &lt;summary&gt;
        /// The Doge Coin flag we all love, but using `find` install stanzas.
        /// &lt;/summary&gt;
        public static CkanModule DogeCoinFlag_101_module_find()
        {
            CkanModule doge = DogeCoinFlag_101_module();

            // Hand hack in the &#39;find&#39; directive.
            doge.install[0].file = null;
            doge.install[0].find = &quot;DogeCoinFlag&quot;;

            return doge;
        }

        // Identical to DogeCoinFlag_101, but with a spec version over 9000!
        public static string FutureMetaData()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: &quot;&quot;v9000.0.1&quot;&quot;,
                    &quot;&quot;identifier&quot;&quot;: &quot;&quot;DogeCoinFlag&quot;&quot;,
                    &quot;&quot;install&quot;&quot;: [
                        {
                        &quot;&quot;file&quot;&quot;: &quot;&quot;DogeCoinFlag-1.01/GameData/DogeCoinFlag&quot;&quot;,
                        &quot;&quot;install_to&quot;&quot;: &quot;&quot;GameData&quot;&quot;,
                        &quot;&quot;filter&quot;&quot; : [ &quot;&quot;Thumbs.db&quot;&quot;, &quot;&quot;README.md&quot;&quot; ],
                        &quot;&quot;filter_regexp&quot;&quot; : &quot;&quot;\\.bak$&quot;&quot;
                        }
                    ],
                    &quot;&quot;resources&quot;&quot;: {
                        &quot;&quot;kerbalstuff&quot;&quot;: {
                        &quot;&quot;url&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag&quot;&quot;
                        },
                        &quot;&quot;homepage&quot;&quot;: &quot;&quot;https://www.reddit.com/r/dogecoin/comments/1tdlgg/i_made_a_more_accurate_dogecoin_and_a_ksp_flag/&quot;&quot;
                    },
                    &quot;&quot;name&quot;&quot;: &quot;&quot;Dogecoin Flag&quot;&quot;,
                    &quot;&quot;license&quot;&quot;: &quot;&quot;CC-BY&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot;: &quot;&quot;Such flag. Very currency. To the mun! Wow!&quot;&quot;,
                    &quot;&quot;author&quot;&quot;: &quot;&quot;pjf&quot;&quot;,
                    &quot;&quot;version&quot;&quot;: &quot;&quot;1.01&quot;&quot;,
                    &quot;&quot;download&quot;&quot;: &quot;&quot;https://kerbalstuff.com/mod/269/Dogecoin%20Flag/download/1.01&quot;&quot;,
                    &quot;&quot;comment&quot;&quot;: &quot;&quot;Generated by ks2ckan&quot;&quot;,
                    &quot;&quot;download_size&quot;&quot;: 53647,
                    &quot;&quot;ksp_version&quot;&quot;: &quot;&quot;0.25&quot;&quot;
                }
            &quot;;
        }

        public static Uri TestKAN()
        {
            return new Uri(&quot;../../../Tests/DATA/CKAN-meta-testkan.zip&quot;, UriKind.Relative);
        }

        // A repo full of deliciously bad metadata...
        public static Uri BadKAN()
        {
            return new Uri(&quot;../../../Tests/DATA/CKAN-meta-badkan.zip&quot;, UriKind.Relative);
        }

        public static string good_ksp_dir()
        {
            return Path.Combine(DataDir(), &quot;KSP/KSP-0.25&quot;);
        }

        public static List&lt;string&gt; bad_ksp_dirs()
        {
            var dirs = new List&lt;string&gt;
            {
                Path.Combine(DataDir(), &quot;KSP/bad-ksp&quot;),
                Path.Combine(DataDir(), &quot;KSP/missing-gamedata&quot;)
            };

            return dirs;
        }

        public static string kOS_014()
        {
            return @&quot;
                {
                    &quot;&quot;spec_version&quot;&quot;: 1,
                    &quot;&quot;name&quot;&quot;     : &quot;&quot;kOS - Kerbal OS&quot;&quot;,
                    &quot;&quot;identifier&quot;&quot; : &quot;&quot;kOS&quot;&quot;,
                    &quot;&quot;abstract&quot;&quot; : &quot;&quot;A programming and automation environment for KSP craft.&quot;&quot;,
                    &quot;&quot;download&quot;&quot; : &quot;&quot;https://github.com/KSP-KOS/KOS/releases/download/v0.14/kOS.v14.zip&quot;&quot;,
                    &quot;&quot;license&quot;&quot;  : &quot;&quot;GPL-3.0&quot;&quot;,
                    &quot;&quot;version&quot;&quot;  : &quot;&quot;0.14&quot;&quot;,
                    &quot;&quot;release_status&quot;&quot; : &quot;&quot;stable&quot;&quot;,
                    &quot;&quot;ksp_version&quot;&quot; : &quot;&quot;0.24.2&quot;&quot;,
                    &quot;&quot;resources&quot;&quot; : {
                        &quot;&quot;homepage&quot;&quot; : &quot;&quot;http://forum.kerbalspaceprogram.com/threads/68089-0-23-kOS-Scriptable-Autopilot-System-v0-11-2-13&quot;&quot;,
                        &quot;&quot;manual&quot;&quot;   : &quot;&quot;http://ksp-kos.github.io/KOS_DOC/&quot;&quot;,
                        &quot;&quot;bugtracker&quot;&quot;: &quot;&quot;https://github.com/KSP-KOS/KOS/issues&quot;&quot;,
                        &quot;&quot;github&quot;&quot;   : {
                            &quot;&quot;url&quot;&quot;      : &quot;&quot;https://github.com/KSP-KOS/KOS&quot;&quot;,
                            &quot;&quot;releases&quot;&quot; : true
                        }
                    },
                    &quot;&quot;install&quot;&quot; : [
                        {
                            &quot;&quot;file&quot;&quot;       : &quot;&quot;GameData/kOS&quot;&quot;,
                            &quot;&quot;install_to&quot;&quot; : &quot;&quot;GameData&quot;&quot;
                        }
                    ]
                }&quot;
            ;
        }

        public static CkanModule kOS_014_module()
        {
            return CkanModule.FromJson(kOS_014());
        }

        public static string KS_CustomAsteroids_string()
        {
            return File.ReadAllText(Path.Combine(DataDir(), &quot;KS/CustomAsteroids.json&quot;));
        }

        public static CkanModule FireSpitterModule()
        {
            return CkanModule.FromFile(Path.Combine(DataDir(), &quot;Firespitter-6.3.5.ckan&quot;));
        }

        public static string KspAvcJson()
        {
            return File.ReadAllText(Path.Combine(DataDir(), &quot;ksp-avc.version&quot;));
        }

        public static string KspAvcJsonOneLineVersion()
        {
            return File.ReadAllText(Path.Combine(DataDir(), &quot;ksp-avc-one-line.version&quot;));
        }

        public static CkanModule ModuleManagerModule()
        {
            return CkanModule.FromFile(DataDir(&quot;ModuleManager-2.5.1.ckan&quot;));
        }

        public static string ModuleManagerZip()
        {
            return DataDir(&quot;ModuleManager-2.5.1.zip&quot;);
        }

        /// &lt;summary&gt;
        /// A path to our test registry.json file. Please copy before using.
        /// &lt;/summary&gt;
        public static string TestRegistry()
        {
            return DataDir(&quot;registry.json&quot;);
        }

        // Where&#39;s my mkdtemp? Instead we&#39;ll make a random file, delete it, and
        // fill its place with a directory.
        // Taken from https://stackoverflow.com/a/20445952
        public static string NewTempDir()
        {
            string temp_folder = Path.GetTempFileName();
            File.Delete(temp_folder);
            Directory.CreateDirectory(temp_folder);

            return temp_folder;
        }

        // Ugh, this is awful.
        public static void CopyDirectory(string src, string dst)
        {
            // Create directory structure
            foreach (string path in Directory.GetDirectories(src, &quot;*&quot;, SearchOption.AllDirectories))
            {
                Directory.CreateDirectory(path.Replace(src, dst));
            }

            // Copy files.
            foreach (string file in Directory.GetFiles(src, &quot;*&quot;, SearchOption.AllDirectories))
            {
                File.Copy(file, file.Replace(src, dst));
            }
        }
    }

    public class RandomModuleGenerator
    {
        public Random Generator { get; set; }

        public RandomModuleGenerator(Random generator)
        {
            Generator = generator;
        }

        public CkanModule GeneratorRandomModule(
            KSPVersion kspVersion = null,
            List&lt;RelationshipDescriptor&gt; conflicts = null,
            List&lt;RelationshipDescriptor&gt; depends = null,
            List&lt;RelationshipDescriptor&gt; sugests = null,
            List&lt;String&gt; provides = null,
            string identifier = null,
            Version version = null)
        {
            var mod = new CkanModule
            {
                name = Generator.Next().ToString(CultureInfo.InvariantCulture),
                @abstract = Generator.Next().ToString(CultureInfo.InvariantCulture),
                identifier = identifier??Generator.Next().ToString(CultureInfo.InvariantCulture),
                spec_version = new Version(1.ToString(CultureInfo.InvariantCulture)),
                ksp_version = kspVersion ?? new KSPVersion(&quot;0.&quot; + Generator.Next()),
                version = version ?? new Version(Generator.Next().ToString(CultureInfo.InvariantCulture))
            };
            mod.ksp_version_max = mod.ksp_version_min = new KSPVersion(null);
            mod.conflicts = conflicts;
            mod.depends = depends;
            mod.suggests = sugests;
            mod.provides = provides;
            return mod;
        }
    }
}


    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,0],[24,13,24,50,0],[25,9,25,10,0],[42,9,42,10,0],[43,13,43,76,0],[44,9,44,10,0],[50,9,50,10,0],[51,13,51,105,0],[53,13,53,46,0],[54,9,54,10,0],[62,9,62,10,0],[63,13,89,15,0],[90,9,90,10,0],[93,9,93,10,0],[94,13,94,67,0],[95,9,95,10,0],[134,9,134,10,0],[135,13,135,60,0],[136,9,136,10,0],[142,9,142,10,0],[143,13,143,57,0],[146,13,146,41,0],[147,13,147,51,0],[149,13,149,25,0],[150,9,150,10,0],[154,9,154,10,0],[155,13,183,15,0],[184,9,184,10,0],[187,9,187,10,0],[188,13,188,91,0],[189,9,189,10,0],[193,9,193,10,0],[194,13,194,90,0],[195,9,195,10,0],[198,9,198,10,0],[199,13,199,60,0],[200,9,200,10,0],[203,9,203,10,0],[204,13,208,15,0],[210,13,210,25,0],[211,9,211,10,0],[214,9,214,10,0],[215,13,242,14,0],[243,9,243,10,0],[246,9,246,10,0],[247,13,247,51,0],[248,9,248,10,0],[256,9,256,10,0],[257,13,257,91,0],[258,9,258,10,0],[271,9,271,10,0],[272,13,272,77,0],[273,9,273,10,0],[276,9,276,10,0],[277,13,277,55,0],[278,9,278,10,0],[284,9,284,10,0],[285,13,285,45,0],[286,9,286,10,0],[292,9,292,10,0],[293,13,293,57,0],[294,13,294,38,0],[295,13,295,52,0],[297,13,297,32,0],[298,9,298,10,0],[302,9,302,10,0],[304,13,304,20,0],[304,37,304,100,0],[304,22,304,33,0],[305,13,305,14,0],[306,17,306,67,0],[307,13,307,14,0],[304,34,304,36,0],[310,13,310,20,0],[310,37,310,94,0],[310,22,310,33,0],[311,13,311,14,0],[312,17,312,57,0],[313,13,313,14,0],[310,34,310,36,0],[314,9,314,10,0],[319,35,319,39,0],[319,40,319,44,0],[321,9,321,55,0],[322,9,322,10,0],[323,13,323,35,0],[324,9,324,10,0],[334,9,334,10,0],[335,13,343,15,0],[344,13,344,78,0],[345,13,345,39,0],[346,13,346,35,0],[347,13,347,36,0],[348,13,348,37,0],[349,13,349,24,0],[350,9,350,10,0],[13,9,13,10,1],[17,13,17,62,1],[19,13,19,61,1],[20,9,20,10,1],[31,9,31,10,1],[32,13,32,98,1],[34,13,34,47,1],[35,9,35,10,1],[101,9,101,10,1],[102,13,130,15,1],[131,9,131,10,1],[251,9,251,10,1],[252,13,252,89,1],[253,9,253,10,1],[261,9,261,10,1],[262,13,262,81,1],[263,9,263,10,1],[266,9,266,10,1],[267,13,267,90,1],[268,9,268,10,1]]);
    </script>
  </body>
</html>